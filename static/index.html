<!DOCTYPE html>
<html>
  <head><title>MRQART</title>
  <link rel="stylesheet" type="text/css" href="static/main.css" />
</head>
<script>
  /* TODO: move into own file. run tests? */
function receivedMessage(msg) {
   console.log("new message!", msg);
   // TODO: 
   // 1. build a sub element id= sessionDate (need to store that field still?) if el w/id doesn't exist
   // 2. append to that element instead of directly to "sequences". then we can later hide finished sequences

   data = JSON.parse(msg.data)
   console.log("...data:", data);
   if(data['type'] == 'new'){
      add_new_series(data['content'])
   }
}
function add_new_series(data) {
   let el = document.createElement("li");
   el.className = data['conforms']?'conform':'no-conform';
   dcm_in =  data['input'];
   errors = data['errors'];
   identity = `${dcm_in['Project']}/${dcm_in['SequenceName']} @ ${dcm_in['SeriesNumber']}`;
   note = Object.keys(errors).length==0?'ðŸ’¯':JSON.stringify(errors);
   console.log("...note:", note);
   el.textContent = `${identity}: ${note}`;
   // TODO: per scanner tab
   let seq = document.getElementById("sequences");
   // clear waiting
   if(seq.innerHTML == "waiting for scanner"){
      seq.innerHTML = ""
   }
   seq.prepend(el); //appendChild(el);
}

function update_via_ws() {
  const ws = new WebSocket("ws://127.0.0.1:5000/");
  ws.addEventListener('message', receivedMessage);
}
window.onload = update_via_ws;

</script>

<body>
  <div id="alert"></div>
  <div id="project"></div>
  <div id="sequence number"></div>
  <ul id="sequences">waiting for scanner</ul>
</body>
</html>
